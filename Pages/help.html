<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>وذكر | المساعدة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8fafc; --card: #ffffff; --text: #0f172a; --primary: #2563eb;
            --secondary: #64748b; --border: #e2e8f0; --shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        [data-theme="dark"] {
            --bg: #020617; --card: #0f172a; --text: #f8fafc; --primary: #3b82f6;
            --secondary: #94a3b8; --border: #1e293b; --shadow: 0 10px 40px rgba(0,0,0,0.4);
        }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; transition: 0.3s; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px 15px 120px; }
        .navbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .logo { font-weight: 900; font-size: 1.6rem; color: var(--primary); }
        .stat-card { background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white; border-radius: 30px; padding: 30px; margin-bottom: 25px; box-shadow: 0 20px 40px rgba(37, 99, 235, 0.2); }
        .card { background: var(--card); border-radius: 25px; padding: 25px; margin-bottom: 20px; border: 1px solid var(--border); box-shadow: var(--shadow); }
        .star-rating { display: flex; gap: 5px; margin-bottom: 15px; color: #fbbf24; font-size: 1.2rem; }
        .star-rating i { cursor: pointer; }
        .review-textarea { width: 100%; border: 1px solid var(--border); background: var(--bg); border-radius: 15px; padding: 12px; font-family: 'Cairo'; color: var(--text); resize: none; margin-bottom: 15px; }
        .btn-submit-review { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 15px; font-weight: 700; cursor: pointer; }
        .review-card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .review-user-info { display: flex; align-items: center; gap: 10px; }
        .review-user-info img { width: 35px; height: 35px; border-radius: 10px; }
    </style>
</head>
<body data-theme="dark">

    <nav class="navbar">
        <div class="logo">وذكر</div>
        <div style="cursor:pointer;" onclick="document.body.dataset.theme = document.body.dataset.theme === 'dark' ? 'light' : 'dark'"><i class="fa-solid fa-circle-half-stroke"></i></div>
    </nav>

    <div class="stat-card">
        <div style="font-size: 3rem; font-weight: 900;">21</div>
        <div style="opacity: 0.8;">مستخدم نشط الآن</div>
    </div>

    <div class="card">
        <h3>عن مشروع وذكر</h3>
        <p style="font-size: 0.9rem; color: var(--secondary);">هدفنا نحول الموبايل من أداة تشتيت لأداة تعينك على ذكر الله.</p>
    </div>

    <div class="card">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
            <img id="reviewUserImg" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" style="width:45px; border-radius:12px;">
            <b id="reviewUserName">جاري التحميل...</b>
        </div>
        <div class="star-rating" id="starInput">
            <i class="fa-solid fa-star" data-v="1"></i>
            <i class="fa-solid fa-star" data-v="2"></i>
            <i class="fa-solid fa-star" data-v="3"></i>
            <i class="fa-solid fa-star" data-v="4"></i>
            <i class="fa-solid fa-star" data-v="5"></i>
        </div>
        <textarea class="review-textarea" id="reviewText" rows="3" placeholder="رأيك يهمنا يا بطل..."></textarea>
        <button class="btn-submit-review" onclick="submitReview()">إرسال التقييم</button>
    </div>

    <h3 style="margin: 25px 10px 15px;">آراء الذاكرين</h3>
    <div id="reviewsList"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, collection, query, orderBy, onSnapshot, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = { apiKey: "AIzaSyA4h9MsH0Szht7taowp95WcBr2y6scXe1k", projectId: "omardev-fbfd8" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentStars = 5;

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const snap = await getDoc(doc(db, "users_azkar", user.uid));
            if (snap.exists()) {
                const d = snap.data();
                document.getElementById('reviewUserName').innerText = d.firstName + ' ' + d.lastName;
                document.getElementById('reviewUserImg').src = d.profilePic || (d.gender === 'أنثى' ? 'https://cdn-icons-png.flaticon.com/512/6997/6997662.png' : 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png');
            }
        }
    });

    window.updateStars = (val) => {
        currentStars = val;
        document.querySelectorAll('#starInput i').forEach(s => {
            s.className = s.getAttribute('data-v') <= val ? 'fa-solid fa-star' : 'fa-regular fa-star';
        });
    };

    document.querySelectorAll('#starInput i').forEach(s => s.onclick = () => window.updateStars(s.getAttribute('data-v')));

    window.submitReview = async () => {
        const text = document.getElementById('reviewText').value.trim();
        if(!text || !auth.currentUser) return alert("تأكد من كتابة النص وتسجيل الدخول");
        try {
            await setDoc(doc(db, "app_reviews", auth.currentUser.uid), {
                userName: document.getElementById('reviewUserName').innerText,
                userPic: document.getElementById('reviewUserImg').src,
                stars: parseInt(currentStars),
                comment: text,
                status: "pending",
                date: new Date().toISOString()
            });
            document.getElementById('reviewText').value = "";
            alert("وصل يا بطل! التقييم تحت المراجعة ✅");
        } catch (e) { alert("حدث خطأ"); }
    };

    const q = query(collection(db, "app_reviews"), where("status", "==", "approved"), orderBy("date", "desc"));
    onSnapshot(q, (snap) => {
        const list = document.getElementById('reviewsList');
        list.innerHTML = snap.empty ? "<p>لا توجد تقييمات منشورة.</p>" : "";
        snap.forEach(d => {
            const r = d.data();
            const stars = Array(5).fill(0).map((_, i) => `<i class="${i < r.stars ? 'fa-solid' : 'fa-regular'} fa-star"></i>`).join('');
            list.innerHTML += `<div class="review-card">
                <div class="review-header"><div class="review-user-info"><img src="${r.userPic}"><b>${r.userName}</b></div></div>
                <div style="color:#fbbf24; font-size:0.7rem; margin-bottom:5px;">${stars}</div>
                <p style="margin:0; font-size:0.85rem; color:var(--secondary);">${r.comment}</p>
            </div>`;
        });
    });
</script>
</body>
</html>
