<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>وذكر | حصن المسلم</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f8fafc;
            --nav-bg: linear-gradient(135deg, #2c3e50, #1a252f);
            --card: #ffffff;
            --text: #334155;
            --primary: #2c3e50;
            --gold: #c5a059;
            --accent: #f1f5f9;
            --shadow: 0 10px 25px rgba(0,0,0,0.05);
        }

        [data-theme="dark"] {
            --bg: #0f172a;
            --nav-bg: #1e293b;
            --card: #1e293b;
            --text: #f1f5f9;
            --accent: #33415544;
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; transition: all 0.3s ease; }

        body {
            font-family: 'Cairo', sans-serif; background: var(--bg);
            margin: 0; min-height: 100vh; color: var(--text); padding-bottom: 50px;
        }

        /* الساكورا */
        .sakura-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .leaf { position: absolute; background: #ffd1dc; border-radius: 100% 0 100% 0; opacity: 0.3; animation: fall linear infinite; }
        @keyframes fall {
            0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }

        /* الناف بار */
        .navbar {
            height: 70px; background: var(--nav-bg); display: flex; align-items: center;
            justify-content: space-between; padding: 0 20px;
            box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; color: #fff;
        }
        .nav-title { font-family: 'Amiri', serif; font-weight: 800; font-size: 1.4rem; color: var(--gold); }
        .nav-btn { width: 45px; height: 45px; display: grid; place-items: center; cursor: pointer; border-radius: 12px; background: rgba(255,255,255,0.1); color: #fff; }

        /* البحث والتصنيف */
        .top-section { padding: 20px; position: relative; z-index: 10; max-width: 700px; margin: auto; }
        .search-box {
            width: 100%; padding: 15px 20px; border-radius: 20px; border: none;
            background: var(--card); color: var(--text); font-family: 'Cairo';
            box-shadow: var(--shadow); margin-bottom: 15px; outline: none;
        }

        .cat-scroller { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; scrollbar-width: none; }
        .cat-scroller::-webkit-scrollbar { display: none; }
        .chip {
            background: var(--card); padding: 8px 18px; border-radius: 15px;
            white-space: nowrap; font-size: 0.85rem; font-weight: 700;
            box-shadow: var(--shadow); cursor: pointer; border: 1px solid transparent;
        }
        .chip.active { background: var(--gold); color: white; }

        /* الكروت */
        .container { padding: 0 20px; max-width: 700px; margin: auto; position: relative; z-index: 5; }
        .zekr-card {
            background: var(--card); border-radius: 25px; padding: 25px;
            margin-bottom: 20px; box-shadow: var(--shadow); border-right: 6px solid var(--gold);
            position: relative;
        }
        .zekr-card.completed { border-right-color: #2ecc71; opacity: 0.7; }
        
        .zekr-cat { font-size: 0.8rem; font-weight: 800; color: var(--gold); display: block; margin-bottom: 10px; }
        .zekr-text { font-family: 'Amiri', serif; font-size: 1.5rem; line-height: 1.8; margin-bottom: 20px; text-align: justify; }

        .zekr-footer { display: flex; justify-content: space-between; align-items: center; border-top: 1px solid var(--accent); padding-top: 15px; }
        
        /* دائرة التسبيح */
        .counter-btn {
            width: 55px; height: 55px; border-radius: 50%; background: var(--accent);
            display: grid; place-items: center; font-weight: 900; font-size: 1.2rem;
            color: var(--primary); border: 2px solid var(--gold); cursor: pointer;
        }
        .completed .counter-btn { background: #2ecc71; color: white; border-color: #2ecc71; }

        .actions { display: flex; gap: 10px; }
        .action-btn { width: 40px; height: 40px; border-radius: 12px; background: var(--accent); display: grid; place-items: center; color: var(--primary); cursor: pointer; }
        .fav-active { color: #e74c3c; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1e293b; color: #fff; padding: 10px 25px; border-radius: 50px; display: none; z-index: 2000; }
    </style>
</head>
<body>

    <div class="sakura-container" id="sakura"></div>

    <nav class="navbar">
        <div class="nav-btn" onclick="toggleTheme()"><i class="fa-solid fa-moon"></i></div>
        <div class="nav-title">حصن المسلم</div>
        <div class="nav-btn" onclick="history.back()"><i class="fa-solid fa-chevron-left"></i></div>
    </nav>

    <div class="top-section">
        <input type="text" id="searchInput" class="search-box" placeholder="ابحث في الأذكار..." onkeyup="renderAzkar()">
        <div class="cat-scroller">
            <div class="chip active" onclick="switchCat('الكل', this)">الكل</div>
            <div class="chip" onclick="switchCat('المفضلة', this)">المفضلة ⭐</div>
            <div class="chip" onclick="switchCat('الصباح', this)">الصباح</div>
            <div class="chip" onclick="switchCat('المساء', this)">المساء</div>
            <div class="chip" onclick="switchCat('النوم', this)">النوم</div>
        </div>
    </div>

    <div class="container" id="azkarList"></div>

    <div id="toast">تم نسخ الذكر</div>

    <script>
        const azkarData = [
            { id: 1, category: "الصباح", text: "أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ.", count: 1 },
            { id: 2, category: "الصباح", text: "اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ، خَلَقْتَنِي وَأَنَا عَبْدُكَ، وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ.", count: 1 },
            { id: 3, category: "المساء", text: "أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ.", count: 1 },
            { id: 4, category: "النوم", text: "بِاسْمِكَ رَبِّي وَضَعْتُ جَنْبِي، وَبِكَ أَرْفَعُهُ، فَإِنْ أَمْسَكْتَ نَفْسِي فَارْحَمْهَا.", count: 1 },
            { id: 5, category: "الاستيقاظ", text: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ.", count: 1 },
            { id: 6, category: "أذكار عامة", text: "سُبْحَانَ اللَّهِ وَبِحَمْدِهِ: عَدَدَ خَلْقِهِ، وَرِضَا نَفْسِهِ، وَزِنَةَ عَرْشِهِ، وَمِدَادَ كَلِمَاتِهِ.", count: 3 }
        ];

        let favorites = JSON.parse(localStorage.getItem('myFavs')) || [];
        let counts = {}; 
        let currentCat = 'الكل';

        function renderAzkar() {
            const list = document.getElementById('azkarList');
            const search = document.getElementById('searchInput').value.toLowerCase();
            list.innerHTML = '';

            const filtered = azkarData.filter(item => {
                const matchesSearch = item.text.includes(search) || item.category.includes(search);
                if (currentCat === 'الكل') return matchesSearch;
                if (currentCat === 'المفضلة') return favorites.includes(item.id) && matchesSearch;
                return item.category === currentCat && matchesSearch;
            });

            filtered.forEach(item => {
                const currentCount = counts[item.id] !== undefined ? counts[item.id] : item.count;
                const isFav = favorites.includes(item.id);
                const isDone = currentCount === 0;

                const card = document.createElement('div');
                card.className = `zekr-card ${isDone ? 'completed' : ''}`;
                card.innerHTML = `
                    <span class="zekr-cat"># ${item.category}</span>
                    <div class="zekr-text" onclick="doCount(${item.id})">${item.text}</div>
                    <div class="zekr-footer">
                        <div class="counter-btn" onclick="doCount(${item.id})">${currentCount}</div>
                        <div class="actions">
                            <div class="action-btn" onclick="copyZekr('${item.text}')"><i class="fa-regular fa-copy"></i></div>
                            <div class="action-btn ${isFav ? 'fav-active' : ''}" onclick="toggleFav(${item.id})">
                                <i class="fa-${isFav ? 'solid' : 'regular'} fa-star"></i>
                            </div>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        function doCount(id) {
            if (counts[id] === undefined) {
                counts[id] = azkarData.find(a => a.id === id).count;
            }
            if (counts[id] > 0) {
                counts[id]--;
                if(navigator.vibrate) navigator.vibrate(30);
                renderAzkar();
            }
        }

        function switchCat(cat, btn) {
            currentCat = cat;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            renderAzkar();
        }

        function toggleFav(id) {
            if (favorites.includes(id)) favorites = favorites.filter(f => f !== id);
            else favorites.push(id);
            localStorage.setItem('myFavs', JSON.stringify(favorites));
            renderAzkar();
        }

        function copyZekr(t) {
            navigator.clipboard.writeText(t);
            const toast = document.getElementById('toast');
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 2000);
        }

        function toggleTheme() {
            const b = document.body;
            b.hasAttribute('data-theme') ? b.removeAttribute('data-theme') : b.setAttribute('data-theme', 'dark');
        }

        function initSakura() {
            const container = document.getElementById('sakura');
            for(let i=0; i<15; i++){
                let leaf = document.createElement('div');
                leaf.className = 'leaf';
                leaf.style.left = Math.random() * 100 + '%';
                leaf.style.animationDuration = (Math.random() * 5 + 5) + 's';
                leaf.style.width = leaf.style.height = (Math.random() * 5 + 5) + 'px';
                container.appendChild(leaf);
            }
        }

        renderAzkar();
        initSakura();
    </script>
</body>
</html>
